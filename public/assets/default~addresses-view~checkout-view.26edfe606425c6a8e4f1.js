(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{VKYi:function(e,t,s){"use strict";var a=s("9c6q"),r=s("NDiG"),n=s("i2Ud"),i=(s("sEfC"),s("tfXw"),{name:"v-suggestion",inheritAttributes:!0,props:{options:{type:Object,default:function(){return{}}},items:{type:Array,default:function(){return[]}},value:{type:String,default:""},sync:{type:Boolean,default:!0},keyField:{type:String},disabled:{type:Boolean,default:!1},error:String},data:function(){return{extendedOptions:Object.assign({},{debounce:0,placeholder:"",inputClass:"input"},this.options),query:this.value,lastSetQuery:null,activeItemIndex:-1,showItems:!1}},watch:{query:function(e,t){e!==this.lastSetQuery?this.$emit("input",e):this.lastSetQuery=null},value:function(e,t){this.setInputQuery(e)},items:function(){this.activeItemIndex=-1,this.showItems=!0}},methods:{hideItems:function(){var e=this;setTimeout((function(){e.showItems=!1,e.sync&&e.setInputQuery(e.value)}),0)},showResults:function(){this.showItems=!0},setInputQuery:function(e){this.lastSetQuery=e,this.query=e},onKeyDown:function(e){switch(this.$emit("keyDown",e.keyCode),e.keyCode){case 40:this.highlightItem("down"),e.preventDefault();break;case 38:this.highlightItem("up"),e.preventDefault();break;case 13:this.selectItem(),e.preventDefault();break;case 27:this.showItems=!1,e.preventDefault();break;default:return!0}},selectItem:function(e){var t=null;if(void 0===e){if(-1===this.activeItemIndex)return;t=this.items[this.activeItemIndex]}else t=this.items[e];t&&(this.$emit("selected",t),this.hideItems())},highlightItem:function(e){var t=this;if(0!==this.items.length){var s=this.items.findIndex((function(e,s){return s===t.activeItemIndex}));-1===s?s="down"===e?0:this.items.length-1:(this.activeIndexItem=0,"down"===e?(s+=1)===this.items.length&&(s=0):(s-=1)<0&&(s=this.items.length-1)),this.activeItemIndex=s;var a=this.$refs.item[this.activeItemIndex];a&&a.scrollIntoView()}},onSuggestionClick:function(){var e=this;this.showItems=!0,this.$nextTick((function(){return e.$refs.input.focus()}))}},beforeMount:function(){}}),o=s("KHd+"),d=Object(o.a)(i,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"v-suggestions",class:{"v-suggestions--invalid":e.error,"v-suggestions--disabled":e.disabled}},[s("label",{staticClass:"v-suggestions__label"},[e._t("default")],2),e._v(" "),s("input",e._b({directives:[{name:"model",rawName:"v-model",value:e.query,expression:"query"}],ref:"input",staticClass:"v-suggestions__input",class:e.extendedOptions.inputClass,attrs:{type:"text",autocomplete:"false",placeholder:e.extendedOptions.placeholder,disabled:e.disabled},domProps:{value:e.query},on:{keydown:e.onKeyDown,blur:e.hideItems,focus:function(t){e.showItems=!0},input:function(t){t.target.composing||(e.query=t.target.value)}}},"input",e.$attrs,!1)),e._v(" "),s("div",{staticClass:"error-message error",attrs:{role:"alert"}},[e._t("error",[e._v("\n            "+e._s(e.error)+"\n        ")],{error:e.error})],2),e._v(" "),e.items&&e.items.length>0&&!0===e.showItems?s("div",{staticClass:"suggestions",on:{mousedown:function(e){e.preventDefault()}}},[s("ul",{staticClass:"items"},e._l(e.items,(function(t,a){return s("li",{key:t[e.keyField]||a,ref:"item",refInFor:!0,staticClass:"item",class:{"is-active":a===e.activeItemIndex},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.selectItem(a)}}},[e._t("item",[e._v("\n                    "+e._s(t)+"\n                ")],{item:t})],2)})),0)]):e._e()])}),[],!1,null,null,null).exports,u=s("KQVR"),c=s("nurM"),l=s("a6oV"),m=s("L2JU"),p=s("55Sm"),_=s("jDKC"),f=s("SqwP"),h=s("J3J1"),v=(s("9roy"),s("SesW")),g=s("3eXy"),y=s("GyY8"),b=s("2JJK"),w=s("8/qD"),k=s("Ffxs");s("WW/F"),s("wASK"),s("xtKy");function x(e,t,s,a,r,n,i){try{var o=e[n](i),d=o.value}catch(e){return void s(e)}o.done?t(d):Promise.resolve(d).then(a,r)}function S(e){return function(){var t=this,s=arguments;return new Promise((function(a,r){var n=e.apply(t,s);function i(e){x(n,a,r,i,o,"next",e)}function o(e){x(n,a,r,i,o,"throw",e)}i(void 0)}))}}function C(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function I(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?C(Object(s),!0).forEach((function(t){$(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):C(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function $(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var O=b.modalName.profile.ADDRESS_EDIT,T={name:O,mixins:[v.b],components:{VSvg:r.a,VButton:n.a,VInput:u.a,VSuggestion:d,GeneralModal:l.a,RadioSwitch:c.a,yandexMap:a.a,ymapMarker:a.b},validations:{address:{city:{required:v.h},house:{required:v.h},post_index:{required:v.h}}},data:function(){return{address:{country_code:"",post_index:"",region:"",region_guid:"",area:"",area_guid:"",city:"",city_guid:"",street:"",house:"",block:"",flat:"",floor:"",porch:"",intercom:"",comment:"",geo_lat:"",geo_lon:""},zoom:null,coords:null,cities:[],streets:[],houses:[],options:{debounce:500},showMap:!1,selectedSwitch:"list",switchItems:[{value:"list",title:"Форма"},{value:"map",title:"Карта"}],markerIcon:{layout:"default#image",imageHref:k.a,imageSize:[24,24],imageOffset:[0,0]}}},computed:I(I(I({},Object(m.d)(p.b,{modalState:function(e){return e[p.a][O]&&e[p.a][O].state||{}}})),Object(m.c)(f.a,[h.a])),{},{computedCoords:function(){return this.coords||this[h.a]},mapSettings:function(){return I({},y.h)},cityError:function(){if(this.$v.address.city.$dirty&&!this.$v.address.city.required)return this.$t("validation.errors.required")},houseError:function(){if(this.$v.address.house.$dirty&&!this.$v.address.house.required)return this.$t("validation.errors.required")},indexError:function(){if(this.$v.address.post_index.$dirty&&!this.$v.address.post_index.required)return this.$t("validation.errors.required")},isTabletLg:function(){return this.$mq.tabletLg},isMap:function(){return"map"===this.selectedSwitch}}),methods:I(I({},Object(m.b)(p.b,[_.a])),{},{findAddress:function(e,t,s,a){var r,n={value:e};switch(e){case w.a.REGION:r={value:w.a.AREA};break;case w.a.CITY:r={value:w.a.CITY};break;case w.a.STREET:r={value:w.a.STREET};break;case w.a.HOUSE:break;default:r={value:e}}return g.$dadata.post("/suggest/address",{query:t,count:s,locations:a,from_bound:n,to_bound:r})},onCityInputChange:function(e){var t=this;return S(regeneratorRuntime.mark((function s(){var a,r;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,t.findAddress(w.a.CITY,e||t.address.value,20);case 3:a=s.sent,r=a.suggestions,t.cities=r,s.next=12;break;case 8:return s.prev=8,s.t0=s.catch(0),console.log(s.t0),s.abrupt("return",null);case 12:case"end":return s.stop()}}),s,null,[[0,8]])})))()},onStreetInputChange:function(){var e=arguments,t=this;return S(regeneratorRuntime.mark((function s(){var a,r,n,i;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return a=e.length>0&&void 0!==e[0]?e[0]:"",s.prev=1,r=[],t.address&&t.address.city_guid&&r.push({city_fias_id:t.address.city_guid}),t.address&&t.address.city&&(a="".concat(t.address.city," ").concat(a)),s.next=7,t.findAddress(w.a.STREET,a,20,r);case 7:n=s.sent,i=n.suggestions,t.streets=i,s.next=16;break;case 12:return s.prev=12,s.t0=s.catch(1),console.log(s.t0),s.abrupt("return",null);case 16:case"end":return s.stop()}}),s,null,[[1,12]])})))()},onHouseInputChange:function(){var e=arguments,t=this;return S(regeneratorRuntime.mark((function s(){var a,r,n,i,o;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return a=e.length>0&&void 0!==e[0]?e[0]:"",s.prev=1,r=[],t.address&&t.address.city_guid&&r.push({city_fias_id:t.address.city_guid}),t.address&&t.address.street_guid&&r.push({street_fias_id:t.address.street_guid}),t.address&&t.address.city&&(a="".concat(t.address.city," ").concat(a)),t.address&&t.address.street&&(a="".concat(t.address.street," ").concat(a)),s.next=9,t.findAddress(w.a.HOUSE,a,20,r);case 9:n=s.sent,i=n.suggestions,o=void 0===i?[]:i,t.houses=o.filter((function(e){return!e.data.settlement})),s.next=19;break;case 15:return s.prev=15,s.t0=s.catch(1),console.log(s.t0),s.abrupt("return",null);case 19:case"end":return s.stop()}}),s,null,[[1,15]])})))()},onCitySelected:function(e){var t=this;return S(regeneratorRuntime.mark((function s(){var a,r;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,t.findAddress(w.a.CITY,e.unrestricted_value,1);case 3:a=s.sent,r=a.suggestions,t.zoom=11,setTimeout((function(){t.applyAddress(w.a.CITY,r[0])}),0),s.next=12;break;case 9:s.prev=9,s.t0=s.catch(0),console.log(s.t0);case 12:case"end":return s.stop()}}),s,null,[[0,9]])})))()},onStreetSelected:function(e){var t=this;return S(regeneratorRuntime.mark((function s(){var a,r;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,t.findAddress(w.a.STREET,e.value,1);case 3:a=s.sent,r=a.suggestions,t.zoom=15,setTimeout((function(){t.applyAddress(w.a.STREET,r[0])}),0),s.next=12;break;case 9:s.prev=9,s.t0=s.catch(0),console.log(s.t0);case 12:case"end":return s.stop()}}),s,null,[[0,9]])})))()},onHouseSelected:function(e){var t=this;return S(regeneratorRuntime.mark((function s(){var a,r;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,t.findAddress(w.a.HOUSE,e.value,1);case 3:a=s.sent,r=a.suggestions,t.zoom=17,setTimeout((function(){t.applyAddress(w.a.HOUSE,r[0])}),0),s.next=12;break;case 9:s.prev=9,s.t0=s.catch(0),console.log(s.t0);case 12:case"end":return s.stop()}}),s,null,[[0,9]])})))()},onMapClick:function(e){var t=this;return S(regeneratorRuntime.mark((function s(){var a,r,n,i;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return a=e.get("coords"),s.next=3,g.$dadata.post("/geolocate/address",{lat:a[0],lon:a[1],radius_meters:1e3});case 3:r=s.sent,n=r.suggestions,i=n.find((function(e){return e.data.house})),t.applyAddress(null,i);case 7:case"end":return s.stop()}}),s)})))()},applyAddress:function(e,t){var s=I({},this.address);switch(e){case w.a.CITY:this.applyCity(t,s),this.applyStreet(null,s),this.applyHouse(null,s);break;case w.a.STREET:this.applyStreet(t,s),this.applyHouse(null,s);break;case w.a.HOUSE:this.applyStreet(t,s),this.applyHouse(t,s);break;default:this.applyCity(t,s),this.applyStreet(t,s),this.applyHouse(t,s)}t.data.postal_code&&(s.post_index=t.data.postal_code),this.applyCoordinates(t,s),this.address=s},applyCity:function(e,t){e&&(t.country_code=e.data.country_iso_code,t.region=e.data.region_with_type||e.data.region,t.region_guid=e.data.region_fias_id,t.area=e.data.area_with_type||e.data.area,t.area_guid=e.data.area_fias_id,t.city=e.data.city_with_type||e.data.city||e.data.settlement_with_type||e.data.settlement,t.city_guid=e.data.city_fias_id||e.data.settlement_fias_id)},applyStreet:function(e,t){e?(t.street=e.data.street_with_type||e.data.street,t.street_guid=e.data.street_fias_id):(t.street=null,t.street_guid=null)},applyHouse:function(e,t){e?(t.street=e.data.street_with_type||e.data.street,t.street_guid=e.data.street_fias_id,t.house=e.data.house_type?"".concat(e.data.house_type," ").concat(e.data.house):e.data.house,t.block=e.data.block_type?"".concat(e.data.block_type," ").concat(e.data.block):e.data.block):(t.house=null,t.block=null)},applyCoordinates:function(e,t){e&&(e.data.geo_lat&&e.data.geo_lon&&(t.geo_lat=e.data.geo_lat,t.geo_lon=e.data.geo_lon),this.coords=[Number(e.data.geo_lat),Number(e.data.geo_lon)]||!1)},onSubmit:function(){if(this.$v.$touch(),!this.$v.$invalid){var e=I(I({},this.address),{},{porch:String(this.address.porch||""),floor:String(this.address.floor||""),flat:String(this.address.flat||""),post_index:String(this.address.post_index)});this.$emit("save",e),this.onClose()}},onClose:function(){this.$emit("close"),this[_.a]({name:O,open:!1,state:{address:null,onSave:null}})},init:function(){this.modalState.address&&(this.modalState.address.geo_lat&&this.modalState.address.geo_lon?(this.zoom=17,this.coords=[Number(this.modalState.address.geo_lat),Number(this.modalState.address.geo_lon)]):this.zoom=11,this.address=I({},this.modalState.address))}}),beforeMount:function(){this.init()},mounted:function(){var e=this;setTimeout((function(){return e.showMap=!0}),300)}},E=Object(o.a)(T,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("general-modal",{staticClass:"address-edit-modal",attrs:{type:e.isTabletLg?"fullscreen":"wide",header:"Выбор пункта выдачи","is-mobile":e.isTabletLg},on:{close:e.onClose},scopedSlots:e._u([{key:"content",fn:function(){return[e.isTabletLg?s("radio-switch",{staticClass:"address-edit-modal__switch",attrs:{name:"map-switch",items:e.switchItems},scopedSlots:e._u([{key:"content",fn:function(t){var a=t.item;return[s("v-svg",{attrs:{name:a.value,width:"24",height:"24"}}),e._v("  "+e._s(a.title)+"\n            ")]}}],null,!1,4253381989),model:{value:e.selectedSwitch,callback:function(t){e.selectedSwitch=t},expression:"selectedSwitch"}}):e._e(),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.isTabletLg||e.isMap,expression:"!isTabletLg || isMap"}],staticClass:"address-edit-modal__map"},[e.showMap?s("yandex-map",{attrs:{zoom:e.zoom,settings:e.mapSettings,coords:e.computedCoords,controls:[],options:{yandexMapDisablePoiInteractivity:!0}},on:{click:e.onMapClick}},[e.coords?s("ymap-marker",{attrs:{"marker-id":"marker-id",coords:e.computedCoords,icon:e.markerIcon}}):e._e()],1):e._e()],1),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.isTabletLg||!e.isMap,expression:"!isTabletLg || !isMap"}],staticClass:"address-edit-modal__form"},[s("div",{staticClass:"address-edit-modal__form-header"},[s("h3",{staticClass:"address-edit-modal__form-header-hl"},[e._v("Адрес доставки")]),e._v(" "),s("span",{staticClass:"text-grey text-sm"},[e._v("Укажите на карте или введите вручную")])]),e._v(" "),s("div",{staticClass:"address-edit-modal__form-row"},[s("v-suggestion",{staticClass:"address-edit-modal__form-column address-edit-modal__form-column--60",attrs:{value:e.address.city,options:e.options,items:e.cities,error:e.cityError},on:{input:e.onCityInputChange,selected:e.onCitySelected},scopedSlots:e._u([{key:"item",fn:function(t){var s=t.item;return[e._v("\n                        "+e._s(s.value)+"\n                    ")]}},{key:"error",fn:function(t){var a=t.error;return[s("transition",{attrs:{name:"slide-in-bottom",mode:"out-in"}},[a?s("div",{key:a},[e._v(e._s(a))]):e._e()])]}}])},[e._v("\n                    Ваш населенный пункт\n                    ")]),e._v(" "),s("v-input",{staticClass:"address-edit-modal__form-column address-edit-modal__form-column--30",attrs:{type:"number",maxlength:"6",min:"1",error:e.indexError},scopedSlots:e._u([{key:"error",fn:function(t){var a=t.error;return[s("transition",{attrs:{name:"slide-in-bottom",mode:"out-in"}},[a?s("div",{key:a},[e._v(e._s(a))]):e._e()])]}}]),model:{value:e.address.post_index,callback:function(t){e.$set(e.address,"post_index",t)},expression:"address.post_index"}},[e._v("\n                    Индекс\n                    ")])],1),e._v(" "),s("div",{staticClass:"address-edit-modal__form-row"},[s("v-suggestion",{staticClass:"address-edit-modal__form-column",attrs:{value:e.address.street,options:e.options,items:e.streets,disabled:!e.address.city},on:{input:e.onStreetInputChange,selected:e.onStreetSelected},scopedSlots:e._u([{key:"item",fn:function(t){var s=t.item;return[e._v("\n                        "+e._s(s.data.street_with_type||s.data.street_with_type)+"\n                    ")]}},{key:"error",fn:function(t){var a=t.error;return[s("transition",{attrs:{name:"slide-in-bottom",mode:"out-in"}},[a?s("div",{key:a},[e._v(e._s(a))]):e._e()])]}}])},[e._v("\n                    Улица\n\n                    ")])],1),e._v(" "),s("div",{staticClass:"address-edit-modal__form-row"},[s("v-suggestion",{staticClass:"address-edit-modal__form-column address-edit-modal__form-column--30",attrs:{value:e.address.house,options:e.options,items:e.houses,disabled:!e.address.city,error:e.houseError},on:{input:e.onHouseInputChange,selected:e.onHouseSelected},scopedSlots:e._u([{key:"item",fn:function(t){var a=t.item;return[e.address.street?e._e():s("span",[e._v("\n                            "+e._s(a.data.street_with_type)+"\n                        ")]),e._v(" "),s("span",[e._v(e._s(a.data.house_type))]),e._v(" "+e._s(a.data.house)+"\n                        "),a.data.block?[e._v(", "),s("span",[e._v(e._s(a.data.block_type))]),e._v(" "+e._s(a.data.block)+"\n                        ")]:e._e()]}},{key:"error",fn:function(t){var a=t.error;return[s("transition",{attrs:{name:"slide-in-bottom",mode:"out-in"}},[a?s("div",{key:a},[e._v(e._s(a))]):e._e()])]}}])},[e._v("\n                    Дом/корпус\n\n                    ")]),e._v(" "),s("v-input",{staticClass:"address-edit-modal__form-column address-edit-modal__form-column--30",model:{value:e.address.block,callback:function(t){e.$set(e.address,"block",t)},expression:"address.block"}},[e._v("\n                    Строение\n                ")]),e._v(" "),s("v-input",{staticClass:"address-edit-modal__form-column address-edit-modal__form-column--30",model:{value:e.address.flat,callback:function(t){e.$set(e.address,"flat",t)},expression:"address.flat"}},[e._v("\n                    Квартира/офис\n                ")])],1),e._v(" "),s("div",{staticClass:"address-edit-modal__form-row"},[s("v-input",{staticClass:"address-edit-modal__form-column address-edit-modal__form-column--30",attrs:{type:"number",min:"1"},model:{value:e.address.floor,callback:function(t){e.$set(e.address,"floor",t)},expression:"address.floor"}},[e._v("\n                    Этаж\n                ")]),e._v(" "),s("v-input",{staticClass:"address-edit-modal__form-column address-edit-modal__form-column--30",attrs:{type:"number",min:"1"},model:{value:e.address.porch,callback:function(t){e.$set(e.address,"porch",t)},expression:"address.porch"}},[e._v("\n                    Подъезд\n                ")]),e._v(" "),s("v-input",{staticClass:"address-edit-modal__form-column address-edit-modal__form-column--30",model:{value:e.address.intercom,callback:function(t){e.$set(e.address,"intercom",t)},expression:"address.intercom"}},[e._v("\n                    Домофон\n                ")])],1),e._v(" "),s("v-input",{attrs:{tag:"textarea",rows:"3",maxHeight:"100"},model:{value:e.address.comment,callback:function(t){e.$set(e.address,"comment",t)},expression:"address.comment"}},[e._v("\n                Комментарий курьеру\n            ")]),e._v(" "),s("div",{staticClass:"address-edit-modal__form-submit"},[s("v-button",{staticClass:"address-edit-modal__form-submit-btn",on:{click:function(t){return t.preventDefault(),e.onSubmit(t)}}},[e._v("\n                    Привезти сюда\n                ")])],1)],1)]},proxy:!0}])})}),[],!1,null,null,null);t.a=E.exports},tfXw:function(e,t,s){},xtKy:function(e,t,s){}}]);
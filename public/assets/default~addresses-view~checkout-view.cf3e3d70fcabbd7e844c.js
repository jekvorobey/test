(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{VKYi:function(e,t,s){"use strict";var r=s("9c6q"),n=s("NDiG"),a=s("i2Ud"),i=(s("sEfC"),s("tfXw"),{name:"v-suggestion",inheritAttributes:!0,props:{options:{type:Object,default:function(){return{}}},items:{type:Array,default:function(){return[]}},value:{type:String,default:""},sync:{type:Boolean,default:!0},keyField:{type:String},disabled:{type:Boolean,default:!1},error:String},data:function(){return{extendedOptions:Object.assign({},{debounce:0,placeholder:"",inputClass:"input"},this.options),query:this.value,lastSetQuery:null,activeItemIndex:-1,showItems:!1}},watch:{query:function(e,t){e!==this.lastSetQuery?this.$emit("input",e):this.lastSetQuery=null},value:function(e,t){this.setInputQuery(e)},items:function(){this.activeItemIndex=-1,this.showItems=!0}},methods:{hideItems:function(){var e=this;setTimeout((function(){e.showItems=!1,e.sync&&e.setInputQuery(e.value)}),0)},showResults:function(){this.showItems=!0},setInputQuery:function(e){this.lastSetQuery=e,this.query=e},onKeyDown:function(e){switch(this.$emit("keyDown",e.keyCode),e.keyCode){case 40:this.highlightItem("down"),e.preventDefault();break;case 38:this.highlightItem("up"),e.preventDefault();break;case 13:this.selectItem(),e.preventDefault();break;case 27:this.showItems=!1,e.preventDefault();break;default:return!0}},selectItem:function(e){var t=null;if(void 0===e){if(-1===this.activeItemIndex)return;t=this.items[this.activeItemIndex]}else t=this.items[e];t&&(this.$emit("selected",t),this.hideItems())},highlightItem:function(e){var t=this;if(0!==this.items.length){var s=this.items.findIndex((function(e,s){return s===t.activeItemIndex}));-1===s?s="down"===e?0:this.items.length-1:(this.activeIndexItem=0,"down"===e?(s+=1)===this.items.length&&(s=0):(s-=1)<0&&(s=this.items.length-1)),this.activeItemIndex=s;var r=this.$refs.item[this.activeItemIndex];r&&r.scrollIntoView()}},onSuggestionClick:function(){var e=this;this.showItems=!0,this.$nextTick((function(){return e.$refs.input.focus()}))}},beforeMount:function(){}}),o=s("KHd+"),d=Object(o.a)(i,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"v-suggestions",class:{"v-suggestions--invalid":e.error,"v-suggestions--disabled":e.disabled}},[s("label",{staticClass:"v-suggestions__label"},[e._t("default")],2),e._v(" "),s("input",e._b({directives:[{name:"model",rawName:"v-model",value:e.query,expression:"query"}],ref:"input",staticClass:"v-suggestions__input",class:e.extendedOptions.inputClass,attrs:{type:"text",autocomplete:"false",placeholder:e.extendedOptions.placeholder,disabled:e.disabled},domProps:{value:e.query},on:{keydown:e.onKeyDown,blur:e.hideItems,focus:function(t){e.showItems=!0},input:function(t){t.target.composing||(e.query=t.target.value)}}},"input",e.$attrs,!1)),e._v(" "),s("div",{staticClass:"error-message error",attrs:{role:"alert"}},[e._t("error",[e._v("\n            "+e._s(e.error)+"\n        ")],{error:e.error})],2),e._v(" "),e.items&&e.items.length>0&&!0===e.showItems?s("div",{staticClass:"suggestions",on:{mousedown:function(e){e.preventDefault()}}},[s("ul",{staticClass:"items"},e._l(e.items,(function(t,r){return s("li",{key:t[e.keyField]||r,ref:"item",refInFor:!0,staticClass:"item",class:{"is-active":r===e.activeItemIndex},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.selectItem(r)}}},[e._t("item",[e._v("\n                    "+e._s(t)+"\n                ")],{item:t})],2)})),0)]):e._e()])}),[],!1,null,null,null).exports,u=s("KQVR"),l=s("nurM"),c=s("a6oV"),m=s("L2JU"),p=s("55Sm"),_=s("jDKC"),f=s("SqwP"),v=s("J3J1"),h=(s("9roy"),s("SesW")),g=s("3eXy"),y=s("GyY8"),b=s("2JJK"),w=s("8/qD"),k=s("Ffxs");s("WW/F"),s("wASK"),s("xtKy");function x(e,t,s,r,n,a,i){try{var o=e[a](i),d=o.value}catch(e){return void s(e)}o.done?t(d):Promise.resolve(d).then(r,n)}function S(e){return function(){var t=this,s=arguments;return new Promise((function(r,n){var a=e.apply(t,s);function i(e){x(a,r,n,i,o,"next",e)}function o(e){x(a,r,n,i,o,"throw",e)}i(void 0)}))}}function C(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function I(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?C(Object(s),!0).forEach((function(t){$(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):C(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function $(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var T=b.modalName.profile.ADDRESS_EDIT,O={name:T,mixins:[h.b],components:{VSvg:n.a,VButton:a.a,VInput:u.a,VSuggestion:d,GeneralModal:c.a,RadioSwitch:l.a,yandexMap:r.a,ymapMarker:r.b},validations:{address:{city:{required:h.i},house:{required:h.i},post_index:{required:h.i}}},data:function(){return{address:{id:null,country_code:null,post_index:null,region:null,region_guid:null,area:null,area_guid:null,city:null,city_guid:null,settlement_guid:null,street:null,street_guid:null,house:null,block:null,flat:null,floor:null,porch:null,intercom:null,comment:null,geo_lat:null,geo_lon:null},zoom:null,coords:null,cities:[],streets:[],houses:[],options:{debounce:500},showMap:!1,selectedSwitch:"list",switchItems:[{value:"list",title:"Форма"},{value:"map",title:"Карта"}],markerIcon:{layout:"default#image",imageHref:k.a,imageSize:[24,24],imageOffset:[0,0]}}},computed:I(I(I({},Object(m.d)(p.b,{modalState:function(e){return e[p.a][T]&&e[p.a][T].state||{}}})),Object(m.c)(f.a,[v.a])),{},{btnText:function(){return this.modalState.btnText||"Сохранить"},computedCoords:function(){return this.coords||this[v.a]},mapSettings:function(){return I({},y.h)},cityError:function(){if(this.$v.address.city.$dirty&&!this.$v.address.city.required)return this.$t("validation.errors.required")},houseError:function(){if(this.$v.address.house.$dirty&&!this.$v.address.house.required)return this.$t("validation.errors.required")},indexError:function(){if(this.$v.address.post_index.$dirty&&!this.$v.address.post_index.required)return this.$t("validation.errors.required")},isDesktop:function(){return this.$mq.desktop},isTabletLg:function(){return this.$mq.tabletLg},isMap:function(){return"map"===this.selectedSwitch}}),methods:I(I({},Object(m.b)(p.b,[_.a])),{},{findAddressById:function(e){return g.$dadata.post("/findById/address",{query:e,count:1})},findAddress:function(e,t,s,r){var n,a={value:e};switch(e){case w.a.REGION:n={value:w.a.AREA};break;case w.a.CITY:n={value:w.a.SETTLEMENT};break;case w.a.STREET:n={value:w.a.STREET};break;case w.a.HOUSE:break;default:n={value:e}}return g.$dadata.post("/suggest/address",{query:t,count:s,locations:r,from_bound:a,to_bound:n})},onCityInputChange:function(e){var t=this;return S(regeneratorRuntime.mark((function s(){var r,n;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,t.findAddress(w.a.CITY,e||t.address.value,20);case 3:r=s.sent,n=r.suggestions,t.cities=n,s.next=12;break;case 8:return s.prev=8,s.t0=s.catch(0),g.$logger.error(s.t0),s.abrupt("return",null);case 12:case"end":return s.stop()}}),s,null,[[0,8]])})))()},onStreetInputChange:function(){var e=arguments,t=this;return S(regeneratorRuntime.mark((function s(){var r,n,a,i,o,d,u;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:"",s.prev=1,n=t.address,a=n.city_guid,i=n.settlement_guid,o={},a&&(o.city_fias_id=a),i&&(o.settlement_fias_id=i),s.next=8,t.findAddress(w.a.STREET,r,20,[o]);case 8:d=s.sent,u=d.suggestions,t.streets=u,s.next=17;break;case 13:return s.prev=13,s.t0=s.catch(1),g.$logger.error(s.t0),s.abrupt("return",null);case 17:case"end":return s.stop()}}),s,null,[[1,13]])})))()},onHouseInputChange:function(){var e=arguments,t=this;return S(regeneratorRuntime.mark((function s(){var r,n,a,i,o,d,u,l,c;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return r=e.length>0&&void 0!==e[0]?e[0]:"",s.prev=1,n=t.address,a=n.city_guid,i=n.settlement_guid,o=n.street_guid,d={},a&&(d.city_fias_id=a),i&&(d.settlement_fias_id=i),o&&(d.street_fias_id=o),s.next=9,t.findAddress(w.a.HOUSE,r,20,d);case 9:u=s.sent,l=u.suggestions,c=void 0===l?[]:l,t.houses=c,s.next=19;break;case 15:return s.prev=15,s.t0=s.catch(1),g.$logger.error(s.t0),s.abrupt("return",null);case 19:case"end":return s.stop()}}),s,null,[[1,15]])})))()},onCitySelected:function(e){var t=this;return S(regeneratorRuntime.mark((function s(){var r,n;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,t.findAddress(w.a.CITY,e.unrestricted_value,1);case 3:r=s.sent,n=r.suggestions,t.zoom=11,setTimeout((function(){t.applyAddress(w.a.CITY,n[0])}),0),s.next=12;break;case 9:s.prev=9,s.t0=s.catch(0),g.$logger.error(s.t0);case 12:case"end":return s.stop()}}),s,null,[[0,9]])})))()},onStreetSelected:function(e){var t=this;return S(regeneratorRuntime.mark((function s(){var r,n;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,t.findAddress(w.a.STREET,e.value,1);case 3:r=s.sent,n=r.suggestions,t.zoom=15,setTimeout((function(){t.applyAddress(w.a.STREET,n[0])}),0),s.next=12;break;case 9:s.prev=9,s.t0=s.catch(0),g.$logger.error(s.t0);case 12:case"end":return s.stop()}}),s,null,[[0,9]])})))()},onHouseSelected:function(e){var t=this;return S(regeneratorRuntime.mark((function s(){var r,n;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,t.findAddress(w.a.HOUSE,e.value,1);case 3:r=s.sent,n=r.suggestions,t.zoom=17,setTimeout((function(){t.applyAddress(w.a.HOUSE,n[0])}),0),s.next=12;break;case 9:s.prev=9,s.t0=s.catch(0),g.$logger.error(s.t0);case 12:case"end":return s.stop()}}),s,null,[[0,9]])})))()},onMapClick:function(e){var t=this;return S(regeneratorRuntime.mark((function s(){var r,n,a,i;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return r=e.get("coords"),s.next=3,g.$dadata.post("/geolocate/address",{lat:r[0],lon:r[1],radius_meters:1e3});case 3:n=s.sent,a=n.suggestions,i=a.find((function(e){return e.data.house})),t.applyAddress(null,i);case 7:case"end":return s.stop()}}),s)})))()},applyAddress:function(e,t){var s=I({},this.address);switch(e){case w.a.CITY:this.applyCity(t,s),this.applyStreet(null,s),this.applyHouse(null,s);break;case w.a.STREET:this.applyStreet(t,s),this.applyHouse(null,s);break;case w.a.HOUSE:this.applyStreet(t,s),this.applyHouse(t,s);break;default:this.applyCity(t,s),this.applyStreet(t,s),this.applyHouse(t,s)}t.data.postal_code&&(s.post_index=t.data.postal_code),this.applyCoordinates(t,s),this.address=s},applyCity:function(e,t){e&&(t.country_code=e.data.country_iso_code,t.region=e.data.region_with_type||e.data.region,t.region_guid=e.data.region_fias_id,t.area=e.data.area_with_type||e.data.area,t.area_guid=e.data.area_fias_id,t.city=e.data.settlement_with_type||e.data.settlement||e.data.city_with_type||e.data.city,t.city_guid=e.data.city_fias_id,t.settlement_guid=e.data.settlement_fias_id)},applyStreet:function(e,t){e?(t.street=e.data.street_with_type||e.data.street,t.street_guid=e.data.street_fias_id):(t.street=null,t.street_guid=null)},applyHouse:function(e,t){e?(t.street=e.data.street_with_type||e.data.street,t.street_guid=e.data.street_fias_id,t.house=e.data.house_type?"".concat(e.data.house_type," ").concat(e.data.house):e.data.house,t.block=e.data.block_type?"".concat(e.data.block_type," ").concat(e.data.block):e.data.block):(t.house=null,t.block=null)},applyCoordinates:function(e,t){e&&(e.data.geo_lat&&e.data.geo_lon&&(t.geo_lat=e.data.geo_lat,t.geo_lon=e.data.geo_lon),this.coords=[Number(e.data.geo_lat),Number(e.data.geo_lon)]||!1)},onSubmit:function(){if(this.$v.$touch(),!this.$v.$invalid){var e=this.address,t=e.id,s=e.country_code,r=e.post_index,n=e.region,a=e.region_guid,i=e.area,o=e.area_guid,d=e.city,u=e.city_guid,l=e.settlement_guid,c=e.street,m=e.house,p=e.block,_=e.flat,f=e.floor,v=e.porch,h={id:t,country_code:s,region:n,region_guid:a,area:i,area_guid:o,city:d,city_guid:l||u,street:c,house:m,block:p,intercom:e.intercom,comment:e.comment,geo_lat:e.geo_lat,geo_lon:e.geo_lon,porch:String(v||""),floor:String(f||""),flat:String(_||""),post_index:String(r||"")};this.$emit("save",h),this.onClose()}},onClose:function(){this.$emit("close"),this[_.a]({name:T,open:!1,state:{address:null,onSave:null}})},init:function(){var e=this;return S(regeneratorRuntime.mark((function t(){var s,r,n,a,i,o,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=e.modalState.address,r=s&&I({},s),t.prev=2,!r){t.next=11;break}return n=r.geo_lat,a=r.geo_lon,i=r.city_guid,n&&a?(e.zoom=17,e.coords=[Number(n),Number(a)]):e.zoom=11,t.next=8,e.findAddressById(i);case 8:o=t.sent,d=o.suggestions,e.applyCity(d[0],r);case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(2),g.$logger.error(t.t0);case 16:Object.assign(e.address,r);case 17:case"end":return t.stop()}}),t,null,[[2,13]])})))()}}),beforeMount:function(){this.init()},mounted:function(){var e=this;setTimeout((function(){var t=e.$refs.citySuggestion.$refs.input;t&&t.focus(),e.showMap=!0}),300)}},E=Object(o.a)(O,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("general-modal",{staticClass:"address-edit-modal",attrs:{type:e.isTabletLg?"fullscreen":"wide",header:"Выбор пункта выдачи","is-mobile":e.isTabletLg},on:{close:e.onClose},scopedSlots:e._u([{key:"content",fn:function(){return[e.isTabletLg?s("radio-switch",{staticClass:"address-edit-modal__switch",attrs:{name:"map-switch",items:e.switchItems},scopedSlots:e._u([{key:"content",fn:function(t){var r=t.item;return[s("v-svg",{attrs:{name:r.value,width:"24",height:"24"}}),e._v("  "+e._s(r.title)+"\n            ")]}}],null,!1,4253381989),model:{value:e.selectedSwitch,callback:function(t){e.selectedSwitch=t},expression:"selectedSwitch"}}):e._e(),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.isTabletLg||e.isMap,expression:"!isTabletLg || isMap"}],staticClass:"address-edit-modal__map"},[e.showMap?s("yandex-map",{attrs:{zoom:e.zoom,settings:e.mapSettings,coords:e.computedCoords,controls:[],options:{yandexMapDisablePoiInteractivity:!0}},on:{click:e.onMapClick}},[e.coords?s("ymap-marker",{attrs:{"marker-id":"marker-id",coords:e.computedCoords,icon:e.markerIcon}}):e._e()],1):e._e()],1),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.isTabletLg||!e.isMap,expression:"!isTabletLg || !isMap"}],staticClass:"address-edit-modal__form"},[s("div",{staticClass:"address-edit-modal__form-header"},[s("h3",{staticClass:"address-edit-modal__form-header-hl"},[e._v("Адрес доставки")]),e._v(" "),s("span",{staticClass:"text-grey text-sm"},[e._v("Укажите на карте или введите вручную")])]),e._v(" "),s("div",{staticClass:"address-edit-modal__form-row"},[s("v-suggestion",{ref:"citySuggestion",staticClass:"address-edit-modal__form-column address-edit-modal__form-column--60",attrs:{value:e.address.city,options:e.options,items:e.cities,error:e.cityError},on:{input:e.onCityInputChange,selected:e.onCitySelected},scopedSlots:e._u([{key:"item",fn:function(t){var s=t.item;return[e._v("\n                        "+e._s(s.value)+"\n                    ")]}},{key:"error",fn:function(t){var r=t.error;return[s("transition",{attrs:{name:"slide-in-bottom",mode:"out-in"}},[r?s("div",{key:r},[e._v(e._s(r))]):e._e()])]}}])},[e._v("\n                    Ваш населенный пункт\n                    ")]),e._v(" "),s("v-input",{staticClass:"address-edit-modal__form-column address-edit-modal__form-column--30",attrs:{type:"number",maxlength:"6",min:"1",error:e.indexError},scopedSlots:e._u([{key:"error",fn:function(t){var r=t.error;return[s("transition",{attrs:{name:"slide-in-bottom",mode:"out-in"}},[r?s("div",{key:r},[e._v(e._s(r))]):e._e()])]}}]),model:{value:e.address.post_index,callback:function(t){e.$set(e.address,"post_index",t)},expression:"address.post_index"}},[e._v("\n                    Индекс\n                    ")])],1),e._v(" "),s("div",{staticClass:"address-edit-modal__form-row"},[s("v-suggestion",{staticClass:"address-edit-modal__form-column",attrs:{value:e.address.street,options:e.options,items:e.streets,disabled:!e.address.city},on:{input:e.onStreetInputChange,selected:e.onStreetSelected},scopedSlots:e._u([{key:"item",fn:function(t){var s=t.item;return[e._v("\n                        "+e._s(s.data.street_with_type||s.data.street_with_type)+"\n                    ")]}},{key:"error",fn:function(t){var r=t.error;return[s("transition",{attrs:{name:"slide-in-bottom",mode:"out-in"}},[r?s("div",{key:r},[e._v(e._s(r))]):e._e()])]}}])},[e._v("\n                    Улица\n\n                    ")])],1),e._v(" "),s("div",{staticClass:"address-edit-modal__form-row"},[s("v-suggestion",{staticClass:"address-edit-modal__form-column address-edit-modal__form-column--30",attrs:{value:e.address.house,options:e.options,items:e.houses,disabled:!e.address.city,error:e.houseError},on:{input:e.onHouseInputChange,selected:e.onHouseSelected},scopedSlots:e._u([{key:"item",fn:function(t){var r=t.item;return[e.address.street?e._e():s("span",[e._v("\n                            "+e._s(r.data.street_with_type)+"\n                        ")]),e._v(" "),s("span",[e._v(e._s(r.data.house_type))]),e._v(" "+e._s(r.data.house)+"\n                        "),r.data.block?[e._v(", "),s("span",[e._v(e._s(r.data.block_type))]),e._v(" "+e._s(r.data.block)+"\n                        ")]:e._e()]}},{key:"error",fn:function(t){var r=t.error;return[s("transition",{attrs:{name:"slide-in-bottom",mode:"out-in"}},[r?s("div",{key:r},[e._v(e._s(r))]):e._e()])]}}])},[e._v("\n                    "+e._s(!e.isDesktop||e.isTabletLg?"Дом/корпус":"Дом/корп.")+"\n\n                    ")]),e._v(" "),s("v-input",{staticClass:"address-edit-modal__form-column address-edit-modal__form-column--30",model:{value:e.address.block,callback:function(t){e.$set(e.address,"block",t)},expression:"address.block"}},[e._v("\n                    Строение\n                ")]),e._v(" "),s("v-input",{staticClass:"address-edit-modal__form-column address-edit-modal__form-column--30",model:{value:e.address.flat,callback:function(t){e.$set(e.address,"flat",t)},expression:"address.flat"}},[e._v("\n                    "+e._s(!e.isDesktop||e.isTabletLg?"Квартира/офис":"Кв./офис")+"\n                ")])],1),e._v(" "),s("div",{staticClass:"address-edit-modal__form-row"},[s("v-input",{staticClass:"address-edit-modal__form-column address-edit-modal__form-column--30",attrs:{type:"number",min:"1"},model:{value:e.address.floor,callback:function(t){e.$set(e.address,"floor",t)},expression:"address.floor"}},[e._v("\n                    Этаж\n                ")]),e._v(" "),s("v-input",{staticClass:"address-edit-modal__form-column address-edit-modal__form-column--30",attrs:{type:"number",min:"1"},model:{value:e.address.porch,callback:function(t){e.$set(e.address,"porch",t)},expression:"address.porch"}},[e._v("\n                    Подъезд\n                ")]),e._v(" "),s("v-input",{staticClass:"address-edit-modal__form-column address-edit-modal__form-column--30",model:{value:e.address.intercom,callback:function(t){e.$set(e.address,"intercom",t)},expression:"address.intercom"}},[e._v("\n                    Домофон\n                ")])],1),e._v(" "),s("v-input",{attrs:{tag:"textarea",rows:"3",maxHeight:"100"},model:{value:e.address.comment,callback:function(t){e.$set(e.address,"comment",t)},expression:"address.comment"}},[e._v("\n                Комментарий курьеру\n            ")]),e._v(" "),s("div",{staticClass:"address-edit-modal__form-submit"},[s("v-button",{staticClass:"address-edit-modal__form-submit-btn",on:{click:function(t){return t.preventDefault(),e.onSubmit(t)}}},[e._v("\n                    "+e._s(e.btnText)+"\n                ")])],1)],1)]},proxy:!0}])})}),[],!1,null,null,null);t.a=E.exports},tfXw:function(e,t,s){},xtKy:function(e,t,s){}}]);